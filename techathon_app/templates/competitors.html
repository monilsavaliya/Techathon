{% extends "base.html" %}

{% block header %}
<div class="flex justify-between items-center w-full">
    <div>
        <h1 class="text-2xl font-bold text-slate-800 tracking-tight">Competitor Intelligence</h1>
        <p class="text-xs text-slate-500 mt-1">Market Analysis & Rival Strategy</p>
    </div>
    <div class="flex gap-2">
        {% if is_admin %}
        <a href="/manage/competitors"
            class="px-4 py-2 text-xs font-bold text-slate-600 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors">
            <i class="fas fa-edit mr-2"></i> Manage Raw Data
        </a>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for c in competitors %}
    <div
        class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden hover:shadow-md transition-all duration-300 group flex flex-col h-full">
        <!-- Header -->
        <div class="p-6 border-b border-slate-50 bg-slate-50/30">
            <div class="flex justify-between items-start mb-4">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wide
                    {% if c.pricing_intelligence.aggression_score >= 8 %}bg-red-100 text-red-700 animate-pulse
                    {% elif c.pricing_intelligence.aggression_score >= 5 %}bg-orange-100 text-orange-700
                    {% else %}bg-emerald-100 text-emerald-700{% endif %}">
                    Aggression: {{ c.pricing_intelligence.aggression_score }}/10
                </span>
                <span class="text-xs font-mono text-slate-400">{{ c.competitor_id }}</span>
            </div>
            <h3 class="text-lg font-bold text-slate-800 leading-tight group-hover:text-blue-600 transition-colors">
                {{ c.name }}
            </h3>
            <p class="text-xs text-slate-500 mt-1">{{ c.tier }}</p>
        </div>

        <!-- Strategy Box -->
        <div class="px-6 py-4 bg-slate-50/50 border-b border-slate-50 flex-1">
            <p class="text-[10px] uppercase text-slate-400 font-bold mb-2">Strategic Behavior</p>
            <p class="text-xs text-slate-600 italic leading-relaxed">
                "{{ c.pricing_intelligence.strategic_behavior }}"
            </p>
        </div>

        <!-- Metrics Footer -->
        <div class="p-6 grid grid-cols-2 gap-4">
            <div>
                <p class="text-[10px] uppercase text-slate-400 font-bold mb-1">Win Rate vs Us</p>
                <div class="flex items-center gap-2">
                    <span class="text-lg font-bold
                        {% if c.performance_metrics.win_rate_against_us > 0.6 %}text-red-600
                        {% elif c.performance_metrics.win_rate_against_us > 0.4 %}text-orange-500
                        {% else %}text-emerald-600{% endif %}">
                        {{ (c.performance_metrics.win_rate_against_us * 100)|int }}%
                    </span>
                    <div class="flex-1 h-1.5 bg-slate-100 rounded-full overflow-hidden">
                        <div class="h-full rounded-full 
                            {% if c.performance_metrics.win_rate_against_us > 0.6 %}bg-red-500
                            {% elif c.performance_metrics.win_rate_against_us > 0.4 %}bg-orange-400
                            {% else %}bg-emerald-500{% endif %}"
                            style="width: {{ c.performance_metrics.win_rate_against_us * 100 }}%">
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-right">
                <p class="text-[10px] uppercase text-slate-400 font-bold mb-1">Avg Undercut</p>
                <p class="font-mono font-bold text-slate-700">
                    {{ "{:+.1f}".format(c.pricing_intelligence.avg_undercut_percent * 100) }}%
                </p>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-span-full text-center py-12">
        <h3 class="text-lg font-medium text-slate-900">No competitors found</h3>
    </div>
    {% endfor %}
</div>
{% endblock %}